# FILE-PULL + HPN SSH

Этот профиль добавляет высокопроизводительное подключение сетевого диска по HPN SSH + SSHFS и включает его в общий пул mergerfs. VPS — главный обработчик файлов, но удалённые хранилища подключаются в режиме read-only, чтобы данные не хранились на VPS.

## Быстрый старт (HPN профиль)

1) Клонируйте репозиторий и переключитесь на ветку:

```
git clone https://github.com/KomarovAI/file-pull.git
cd file-pull
git checkout feature/hpn-ssh-integration
```

2) Создайте конфиг .env:

```
cp .env.example .env
# Отредактируйте значения
HPN_ENABLED=true
HPN_REMOTE_HOST=IP_ВAШЕГО_ПК
HPN_REMOTE_USER=USER_НА_ПК
HPN_REMOTE_PORT=2222
HPN_REMOTE_PATH=/путь/к/папке
```

3) На вашем ПК установите и запустите HPN SSH сервер:

- Сгенерируйте публичный ключ в контейнере (будет создан автоматически при первом старте: configs/hpn_key.pub)
- Добавьте его в ~/.ssh/authorized_keys на ПК
- Откройте порт 2222 в фаерволе

Опционально используйте скрипт, который сгенерирует приложение внутри для установки HPN SSH сервера (см. src/hpn_ssh_manager.py → generate_pc_setup_script()).

4) Соберите и запустите профиль:

```
docker compose -f docker-compose.hpn.yml up -d --build
```

5) Проверка логов и бенчмарк:

```
docker logs -f file-pull-hpn
# В логах отобразится бенчмарк чтения/записи HPN SSH диска
```

## Как это работает

- Контейнер монтирует удалённый диск с вашего ПК через SSHFS с HPN-оптимизациями
- /mnt/hpn-remote добавляется в mergerfs как read-only
- Локальная запись идёт только в /data/local (на VPS)
- Управление, мониторинг и автопереподключение выполняет HPNSSHManager

## Важные заметки

- Для максимальной скорости используйте шифр aes128-ctr и отключите сжатие
- Включён BBR и увеличенные TCP буферы (см. docker-compose.hpn.yml → sysctls)
- Если сеть нестабильна, уменьшите max_conns и ослабьте параметры кеширования SSHFS

## Безопасность

- Аутентификация только по ключам
- Ключи хранятся в configs/hpn_key (+ .pub)
- Монтирование удалённых источников в режиме ro
